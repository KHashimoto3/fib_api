# ソースコードについて

## 構成

- `go.mod / go.sum` ：モジュールの構成やインポートの内容について記述
- `main.go` :API 本体のコード
- `main_test.go` :API をテストするためのコード

## 概要（`main.go`）

### main 関数

最初に呼ばれる関数。api としてアクセスできるようにする`setUpRouter`関数を呼び、ポート 8080 番を使ってサーバを起動し、アクセス待ち状態にする。

### setUpRouter 関数

エンドポイントに関数を割り当て、API としてアクセスできるようにする。

- `/fib`にアクセスすることで、`getFib`関数（フィボナッチ数を計算するための `fib` 関数を使用する）を呼ぶ。
- `/`にアクセスした際に表示するための `hello` 関数も用意している。

### getFib 関数

リクエストのクエリパラメータ（`n`）を取り出す。  
パタメータがない場合や、無効な値の場合は、400 コードとエラーメッセージを返す。  
クエリパラメータは文字列なので、処理に使うために `int` 型に直している。  
値に問題がなければ、`fib` 関数を読んでフィボナッチ数を取得し、 `result`の値として値を返す。

### fib 関数

フィボナッチ数を計算する関数。  
計算量を抑えるため、順に値を足して積み上げていく方式を採用している。（再帰にすると処理が膨大になり、大きな `n` の値に対応できない）。  
また、フィボナッチ数の値が大きくなってしまうため、`bigInt`型を使用している。  
ループを使用して、値を足しながら値を書き換えていき、フィボナッチ数 bigX を求める。  
ループを終了したら、その時の`bigX`の値を`getFib`関数に返す。

## 概要（`main_test.go`）

テストを行うための関数`TestFibRoute`関数が呼ばれる。  
テストの追加をしやすいよう、テストケースは`TestCase`型の構造体に格納するようにした。  
testCase という構造体の変数にテストケースを格納する。  
テストはまず、空のパラメータがあった場合のテストを行い、その後は、渡されるパラメータに応じて正しいレスポンス（エラーの場合を含む）が返ってくるかをテストする。
